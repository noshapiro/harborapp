<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harbor â€” letters that find their way</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --ink: #1a1a2e; --deep: #0a0e1a; --ocean: #0f3460; --wave: #16213e;
  --foam: #e8e4d9; --parchment: #f5f0e8; --sand: #c9b99a; --gold: #c4972f;
  --bg: #0d0f18;
}

body {
  font-family: 'Crimson Pro', serif;
  background: radial-gradient(ellipse at 20% 10%, #1a1f3a 0%, #0a0c16 40%, #0d1520 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  overflow-x: hidden;
}

/* Ambient background particles */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    radial-gradient(1px 1px at 15% 20%, rgba(255,255,255,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 35% 8%, rgba(255,255,255,0.3) 0%, transparent 100%),
    radial-gradient(1.5px 1.5px at 55% 15%, rgba(255,255,255,0.5) 0%, transparent 100%),
    radial-gradient(1px 1px at 75% 5%, rgba(255,255,255,0.2) 0%, transparent 100%),
    radial-gradient(1px 1px at 90% 25%, rgba(255,255,255,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 8% 45%, rgba(255,255,255,0.2) 0%, transparent 100%),
    radial-gradient(1px 1px at 92% 60%, rgba(255,255,255,0.3) 0%, transparent 100%),
    radial-gradient(1.5px 1.5px at 25% 75%, rgba(255,255,255,0.15) 0%, transparent 100%),
    radial-gradient(1px 1px at 70% 85%, rgba(255,255,255,0.25) 0%, transparent 100%),
    radial-gradient(1px 1px at 45% 90%, rgba(255,255,255,0.2) 0%, transparent 100%);
  pointer-events: none;
  z-index: 0;
}

/* Page title */
.page-brand {
  text-align: center;
  margin-bottom: 32px;
  position: relative;
  z-index: 2;
}
.page-brand h1 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 42px;
  font-weight: 300;
  letter-spacing: 0.3em;
  color: var(--foam);
  opacity: 0.9;
}
.page-brand p {
  font-size: 13px;
  color: var(--sand);
  opacity: 0.5;
  letter-spacing: 0.15em;
  font-style: italic;
  margin-top: 6px;
}

/* Navigation pills */
.nav-pills {
  display: flex;
  gap: 8px;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 32px;
  position: relative;
  z-index: 2;
}
.nav-pills button {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(201,185,154,0.18);
  color: var(--sand);
  padding: 8px 20px;
  border-radius: 30px;
  font-family: 'Crimson Pro', serif;
  font-size: 13px;
  cursor: pointer;
  letter-spacing: 0.08em;
  transition: all 0.3s ease;
  opacity: 0.6;
  backdrop-filter: blur(4px);
}
.nav-pills button:hover { opacity: 0.9; border-color: rgba(201,185,154,0.4); }
.nav-pills button.active {
  opacity: 1;
  background: rgba(201,185,154,0.12);
  border-color: var(--sand);
  color: var(--parchment);
}

/* iPhone 14 Pro frame */
.iphone-wrapper {
  position: relative;
  z-index: 2;
  width: 393px;
  height: 852px;
  /* Phone frame */
  background: #1c1c1e;
  border-radius: 54px;
  box-shadow:
    0 0 0 2px #3a3a3c,
    0 0 0 4px #1c1c1e,
    0 0 0 6px #2a2a2c,
    0 40px 100px rgba(0,0,0,0.8),
    0 10px 40px rgba(0,0,0,0.6),
    inset 0 0 0 1px rgba(255,255,255,0.06);
  overflow: hidden;
  flex-shrink: 0;
}

/* Side buttons */
.iphone-wrapper::before {
  content: '';
  position: absolute;
  left: -4px;
  top: 140px;
  width: 4px;
  height: 34px;
  background: #2c2c2e;
  border-radius: 2px 0 0 2px;
  box-shadow: 0 44px 0 #2c2c2e, 0 82px 0 #2c2c2e;
  z-index: 20;
}
.iphone-wrapper::after {
  content: '';
  position: absolute;
  right: -4px;
  top: 180px;
  width: 4px;
  height: 70px;
  background: #2c2c2e;
  border-radius: 0 2px 2px 0;
  z-index: 20;
}

/* Screen area */
.iphone-screen {
  position: absolute;
  inset: 0;
  border-radius: 54px;
  overflow: hidden;
  background: var(--deep);
}

/* Dynamic Island */
.dynamic-island {
  position: absolute;
  top: 14px;
  left: 50%;
  transform: translateX(-50%);
  width: 126px;
  height: 37px;
  background: #000;
  border-radius: 20px;
  z-index: 100;
}

/* Status bar */
.status-bar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 59px;
  z-index: 50;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  padding: 0 30px 8px;
  background: transparent;
  pointer-events: none;
}
.status-time {
  font-size: 16px;
  font-weight: 600;
  color: var(--foam);
  font-family: -apple-system, sans-serif;
  letter-spacing: 0.02em;
}
.status-icons {
  display: flex;
  align-items: center;
  gap: 7px;
}
.status-icons svg { opacity: 0.9; }

/* App screens container */
.screens-container {
  position: absolute;
  inset: 0;
  border-radius: 54px;
  overflow: hidden;
}

.screen { display: none; width: 100%; height: 100%; overflow-y: auto; overflow-x: hidden; }
.screen.active { display: block; }
.screen::-webkit-scrollbar { display: none; }

/* ===== SPLASH ===== */
.splash {
  height: 100%;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: linear-gradient(180deg, #040610 0%, #080e1d 25%, #0c1e35 55%, #0f2845 75%, #091520 100%);
}
.splash-stars { position: absolute; inset: 0; pointer-events: none; }
.splash-star {
  position: absolute;
  border-radius: 50%;
  background: white;
  animation: twinkle var(--d, 3s) var(--delay, 0s) infinite alternate ease-in-out;
}
@keyframes twinkle {
  from { opacity: var(--o, 0.3); transform: scale(1); }
  to { opacity: calc(var(--o, 0.3) * 0.2); transform: scale(0.6); }
}

.splash-waves { position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; pointer-events: none; }
.splash-wave {
  position: absolute;
  width: 250%;
  left: -75%;
  border-radius: 50%;
  opacity: 0.9;
}
.w1 { bottom: 0; height: 220px; background: radial-gradient(ellipse at 50% 100%, #0e3158 0%, #0a2040 100%); animation: wave1 9s ease-in-out infinite; }
.w2 { bottom: 30px; height: 190px; background: radial-gradient(ellipse at 40% 100%, rgba(15,40,70,0.7) 0%, transparent 100%); animation: wave2 11s ease-in-out infinite reverse; }
.w3 { bottom: 55px; height: 160px; background: radial-gradient(ellipse at 60% 100%, rgba(12,30,58,0.5) 0%, transparent 100%); animation: wave3 13s ease-in-out infinite; }
@keyframes wave1 { 0%,100%{transform:translateX(0) scaleY(1)} 50%{transform:translateX(-4%) scaleY(1.06)} }
@keyframes wave2 { 0%,100%{transform:translateX(-2%)} 50%{transform:translateX(4%)} }
@keyframes wave3 { 0%,100%{transform:translateX(3%)} 50%{transform:translateX(-5%)} }

/* Subtle ocean shimmer */
.ocean-shimmer {
  position: absolute;
  bottom: 60px;
  left: 0; right: 0;
  height: 120px;
  background: linear-gradient(0deg, rgba(15,50,100,0.3) 0%, transparent 100%);
  pointer-events: none;
}
.shimmer-line {
  position: absolute;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(196,151,47,0.2), transparent);
  animation: shimmerMove var(--sd, 4s) var(--ss, 0s) infinite ease-in-out;
}
@keyframes shimmerMove {
  0%,100%{opacity:0.2; transform: translateX(-10px) scaleX(0.8);}
  50%{opacity:0.6; transform: translateX(10px) scaleX(1.2);}
}

.bottle-float {
  position: absolute;
  bottom: 26%;
  left: 50%;
  transform: translateX(-50%);
  animation: bottleFloat 7s ease-in-out infinite;
  z-index: 15;
  filter: drop-shadow(0 12px 30px rgba(0,0,0,0.6));
}
@keyframes bottleFloat {
  0%,100%{transform:translateX(-50%) rotate(-6deg) translateY(0);}
  30%{transform:translateX(calc(-50% + 10px)) rotate(3deg) translateY(-10px);}
  65%{transform:translateX(calc(-50% - 8px)) rotate(-9deg) translateY(5px);}
}

.splash-content {
  position: relative;
  z-index: 20;
  text-align: center;
  padding-top: 80px;
  padding-bottom: 260px;
}
.splash-wordmark {
  font-family: 'Cormorant Garamond', serif;
  font-size: 64px;
  font-weight: 300;
  letter-spacing: 0.2em;
  color: var(--foam);
  line-height: 1;
  animation: fadeUp 1.4s ease-out both;
}
.splash-tagline {
  font-size: 13px;
  font-weight: 300;
  color: var(--sand);
  letter-spacing: 0.12em;
  font-style: italic;
  margin-top: 12px;
  opacity: 0;
  animation: fadeUp 1.4s 0.4s ease-out both;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(18px); }
  to { opacity: 1; transform: translateY(0); }
}
.splash-cta {
  position: absolute;
  bottom: 72px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 20;
  text-align: center;
  opacity: 0;
  animation: fadeUp 1.4s 0.9s ease-out both;
  width: 200px;
}
.btn-begin {
  display: block;
  width: 100%;
  padding: 15px 0;
  border: 1px solid rgba(201,185,154,0.5);
  color: var(--parchment);
  font-family: 'Cormorant Garamond', serif;
  font-size: 15px;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  cursor: pointer;
  background: rgba(201,185,154,0.06);
  border-radius: 2px;
  transition: all 0.4s;
  backdrop-filter: blur(4px);
}
.btn-begin:hover { background: rgba(201,185,154,0.15); border-color: var(--sand); }
.splash-hint {
  margin-top: 12px;
  font-size: 11px;
  color: rgba(232,228,217,0.25);
  letter-spacing: 0.06em;
}

/* ===== HOME / INBOX ===== */
.home-screen {
  min-height: 100%;
  background: linear-gradient(180deg, #08101e 0%, #0a0e1a 100%);
  padding-bottom: 90px;
  padding-top: 59px;
}
.home-header {
  padding: 20px 24px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 59px;
  background: rgba(8,16,30,0.9);
  backdrop-filter: blur(12px);
  z-index: 10;
  border-bottom: 1px solid rgba(201,185,154,0.06);
}
.home-logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: 26px;
  font-weight: 300;
  letter-spacing: 0.2em;
  color: var(--foam);
}
.avatar-btn {
  display: flex;
  align-items: center;
  gap: 9px;
  cursor: pointer;
  transition: opacity 0.2s;
}
.avatar-btn:hover { opacity: 0.8; }
.avatar-circle {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, #1e4a6e, #0d1b2a);
  border: 1.5px solid rgba(196,151,47,0.5);
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 12px rgba(196,151,47,0.2);
}
.avatar-lh {
  position: absolute;
  bottom: 4px;
  left: 50%;
  transform: translateX(-50%);
  width: 8px;
  height: 18px;
  background: rgba(232,228,217,0.5);
  clip-path: polygon(22% 100%, 78% 100%, 62% 0%, 38% 0%);
}
.avatar-top {
  position: absolute;
  top: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 12px;
  height: 7px;
  background: rgba(196,151,47,0.85);
  border-radius: 3px 3px 0 0;
  box-shadow: 0 0 10px rgba(196,151,47,0.6);
}
.avatar-name { font-size: 12px; color: var(--sand); letter-spacing: 0.04em; }

.inbox-section {
  padding: 24px 20px 12px;
}
.inbox-label {
  font-size: 10px;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: rgba(201,185,154,0.4);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.inbox-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: rgba(201,185,154,0.08);
}

.new-letter-banner {
  margin: 0 20px 16px;
  padding: 18px 20px;
  background: linear-gradient(135deg, rgba(196,151,47,0.08) 0%, rgba(196,151,47,0.03) 100%);
  border: 1px solid rgba(196,151,47,0.25);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}
.new-letter-banner::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 3px;
  height: 100%;
  background: var(--gold);
}
.new-letter-banner:hover {
  background: linear-gradient(135deg, rgba(196,151,47,0.14) 0%, rgba(196,151,47,0.06) 100%);
  border-color: rgba(196,151,47,0.4);
}
.new-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 10px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 8px;
}
.new-badge-dot {
  width: 5px; height: 5px;
  background: var(--gold);
  border-radius: 50%;
  animation: glow 2s infinite;
}
@keyframes glow { 0%,100%{opacity:0.4; box-shadow:0 0 0 0 rgba(196,151,47,0.4);} 50%{opacity:1; box-shadow:0 0 0 4px rgba(196,151,47,0);} }
.banner-preview {
  font-size: 15px;
  line-height: 1.6;
  color: rgba(232,228,217,0.75);
  font-style: italic;
  margin-bottom: 10px;
}
.banner-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.banner-from {
  font-size: 11px;
  color: var(--sand);
  opacity: 0.6;
  font-style: italic;
  letter-spacing: 0.04em;
}
.banner-arrow {
  font-size: 18px;
  color: rgba(196,151,47,0.5);
  transition: transform 0.2s;
}
.new-letter-banner:hover .banner-arrow { transform: translateX(4px); }

.letter-card {
  margin: 0 20px 10px;
  border: 1px solid rgba(201,185,154,0.1);
  border-radius: 6px;
  background: rgba(255,255,255,0.02);
  padding: 16px 18px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative;
  overflow: hidden;
}
.letter-card::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 3px;
  background: var(--gold);
  opacity: 0;
  transition: opacity 0.25s;
  border-radius: 0 2px 2px 0;
}
.letter-card:hover { background: rgba(255,255,255,0.04); border-color: rgba(201,185,154,0.2); }
.letter-card:hover::before, .letter-card.unread::before { opacity: 1; }
.letter-card.unread { background: rgba(196,151,47,0.03); }
.lc-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.lc-from { font-size: 12px; letter-spacing: 0.06em; color: var(--sand); font-style: italic; display: flex; align-items: center; gap: 6px; }
.lc-unread-dot { width: 5px; height: 5px; background: var(--gold); border-radius: 50%; animation: glow 2s infinite; }
.lc-date { font-size: 10px; color: rgba(232,228,217,0.25); letter-spacing: 0.04em; }
.lc-preview { font-size: 14px; line-height: 1.65; color: rgba(232,228,217,0.6); font-style: italic; }

.send-another-btn {
  margin: 4px 20px 0;
  width: calc(100% - 40px);
  padding: 12px;
  background: transparent;
  border: 1px dashed rgba(201,185,154,0.18);
  border-radius: 6px;
  color: rgba(201,185,154,0.4);
  font-family: 'Crimson Pro', serif;
  font-size: 13px;
  letter-spacing: 0.08em;
  font-style: italic;
  cursor: pointer;
  transition: all 0.3s;
}
.send-another-btn:hover { border-color: rgba(201,185,154,0.35); color: rgba(201,185,154,0.7); }

.write-fab {
  position: sticky;
  bottom: 100px;
  left: calc(100% - 68px);
  width: 52px;
  height: 52px;
  background: linear-gradient(135deg, rgba(196,151,47,0.25), rgba(196,151,47,0.12));
  border: 1px solid rgba(196,151,47,0.5);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(196,151,47,0.2);
  transition: all 0.3s;
  font-size: 22px;
  z-index: 5;
  margin-right: 16px;
}
.write-fab:hover {
  background: linear-gradient(135deg, rgba(196,151,47,0.4), rgba(196,151,47,0.2));
  box-shadow: 0 6px 28px rgba(196,151,47,0.35);
  transform: scale(1.05);
}

/* Tab bar */
.tab-bar {
  position: sticky;
  bottom: 0;
  left: 0; right: 0;
  background: rgba(6,10,20,0.96);
  border-top: 1px solid rgba(201,185,154,0.08);
  display: flex;
  padding: 10px 0 28px;
  backdrop-filter: blur(16px);
  z-index: 50;
}
.tab-item {
  flex: 1;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 9.5px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--foam);
  padding-top: 2px;
  opacity: 0.3;
}
.tab-item.active { opacity: 1; color: var(--sand); }
.tab-item:hover { opacity: 0.7; }
.tab-icon { font-size: 22px; display: block; margin-bottom: 3px; }

/* ===== WRITE ===== */
.write-screen {
  min-height: 100%;
  background: linear-gradient(160deg, #0d1e32 0%, #08101e 100%);
  padding-bottom: 24px;
  padding-top: 59px;
}
.write-header {
  padding: 16px 20px 14px;
  display: flex;
  align-items: center;
  gap: 14px;
  border-bottom: 1px solid rgba(201,185,154,0.07);
  position: sticky;
  top: 59px;
  background: rgba(12,20,32,0.92);
  backdrop-filter: blur(10px);
  z-index: 10;
}
.back-btn {
  width: 32px; height: 32px;
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(201,185,154,0.1);
  border-radius: 50%;
  color: var(--foam);
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s;
}
.back-btn:hover { background: rgba(255,255,255,0.08); }
.write-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 18px;
  font-weight: 300;
  font-style: italic;
  color: var(--foam);
  letter-spacing: 0.08em;
}

.paper-wrap {
  margin: 20px 18px 0;
  background: var(--parchment);
  border-radius: 4px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.5), 0 2px 10px rgba(0,0,0,0.3);
  overflow: hidden;
}
.paper-top {
  height: 4px;
  background: linear-gradient(90deg, rgba(196,151,47,0.4) 0%, rgba(196,151,47,0.15) 100%);
}
.paper-inner {
  padding: 28px 22px;
  min-height: 280px;
  position: relative;
}
.paper-inner::before {
  content: '';
  position: absolute;
  inset: 28px 22px;
  background: repeating-linear-gradient(transparent, transparent 27px, rgba(201,185,154,0.28) 27px, rgba(201,185,154,0.28) 28px);
  pointer-events: none;
}
.letter-textarea {
  width: 100%;
  min-height: 250px;
  background: transparent;
  border: none;
  outline: none;
  font-family: 'Crimson Pro', serif;
  font-size: 16.5px;
  line-height: 28px;
  color: var(--ink);
  resize: none;
  position: relative;
  z-index: 1;
}
.letter-textarea::placeholder { color: rgba(26,26,46,0.28); font-style: italic; }
.paper-footer {
  padding: 12px 22px 16px;
  border-top: 1px solid rgba(201,185,154,0.2);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.char-count { font-size: 11px; color: rgba(26,26,46,0.3); font-style: italic; }
.draw-pill {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  cursor: pointer;
  background: none;
  border: 1px solid rgba(26,26,46,0.15);
  color: rgba(26,26,46,0.5);
  padding: 6px 14px;
  border-radius: 20px;
  font-family: 'Crimson Pro', serif;
  transition: all 0.2s;
}
.draw-pill:hover { border-color: rgba(26,26,46,0.3); color: rgba(26,26,46,0.8); }

.write-footer {
  padding: 20px 18px;
}
.send-note {
  font-size: 11.5px;
  color: rgba(232,228,217,0.3);
  text-align: center;
  letter-spacing: 0.04em;
  font-style: italic;
  margin-bottom: 14px;
  line-height: 1.7;
}
.send-note em { color: rgba(196,151,47,0.6); font-style: normal; }
.btn-send {
  width: 100%;
  padding: 15px;
  background: transparent;
  border: 1px solid rgba(196,151,47,0.4);
  color: var(--gold);
  font-family: 'Cormorant Garamond', serif;
  font-size: 18px;
  font-weight: 300;
  letter-spacing: 0.2em;
  cursor: pointer;
  transition: all 0.35s;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
.btn-send:hover {
  background: rgba(196,151,47,0.08);
  border-color: var(--gold);
  box-shadow: 0 0 20px rgba(196,151,47,0.1);
}
.btn-send:active { transform: scale(0.98); }

/* ===== READ ===== */
.read-screen {
  min-height: 100%;
  background: linear-gradient(160deg, #0d1e32 0%, #08101e 100%);
  padding-bottom: 24px;
  padding-top: 59px;
}
.read-header {
  padding: 16px 20px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(201,185,154,0.07);
  position: sticky;
  top: 59px;
  background: rgba(12,20,32,0.92);
  backdrop-filter: blur(10px);
  z-index: 10;
}
.read-from {
  font-family: 'Cormorant Garamond', serif;
  font-size: 16px;
  font-weight: 300;
  font-style: italic;
  color: var(--foam);
  letter-spacing: 0.06em;
}
.report-btn {
  font-size: 11px;
  cursor: pointer;
  letter-spacing: 0.06em;
  background: none;
  border: none;
  color: rgba(232,228,217,0.28);
  font-family: 'Crimson Pro', serif;
  transition: color 0.2s;
}
.report-btn:hover { color: rgba(232,228,217,0.6); }

.translation-bar {
  margin: 14px 18px 0;
  padding: 9px 14px;
  background: rgba(196,151,47,0.06);
  border: 1px solid rgba(196,151,47,0.18);
  border-radius: 6px;
  font-size: 11px;
  color: rgba(196,151,47,0.75);
  letter-spacing: 0.04em;
  display: flex;
  align-items: center;
  gap: 7px;
}

.letter-paper {
  margin: 14px 18px;
  background: var(--parchment);
  border-radius: 4px;
  box-shadow: 0 6px 30px rgba(0,0,0,0.45);
  overflow: hidden;
}
.letter-paper-top { height: 4px; background: linear-gradient(90deg, rgba(196,151,47,0.3), transparent); }
.letter-paper-inner {
  padding: 28px 22px;
  position: relative;
}
.letter-paper-inner::before {
  content: '';
  position: absolute;
  inset: 28px 22px;
  background: repeating-linear-gradient(transparent, transparent 27px, rgba(201,185,154,0.28) 27px, rgba(201,185,154,0.28) 28px);
  pointer-events: none;
}
.letter-text {
  font-family: 'Crimson Pro', serif;
  font-size: 16px;
  line-height: 28px;
  color: var(--ink);
  font-style: italic;
  position: relative;
  z-index: 1;
}
.letter-sketch {
  margin-top: 20px;
  border-top: 1px solid rgba(201,185,154,0.3);
  padding-top: 14px;
}
.sketch-placeholder {
  width: 100%;
  height: 80px;
  background: repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(201,185,154,0.1) 4px, rgba(201,185,154,0.1) 5px);
  border-radius: 3px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: rgba(26,26,46,0.3);
  font-style: italic;
}
.letter-sig {
  font-size: 11px;
  color: rgba(26,26,46,0.38);
  text-align: right;
  margin-top: 18px;
  font-style: italic;
  position: relative;
  z-index: 1;
  padding-bottom: 4px;
}

.letter-actions {
  margin: 4px 18px 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.btn-reply {
  width: 100%;
  padding: 14px;
  background: transparent;
  border: 1px solid rgba(196,151,47,0.4);
  color: var(--gold);
  font-family: 'Cormorant Garamond', serif;
  font-size: 17px;
  font-weight: 300;
  letter-spacing: 0.15em;
  cursor: pointer;
  transition: all 0.3s;
  border-radius: 4px;
}
.btn-reply:hover { background: rgba(196,151,47,0.08); border-color: var(--gold); }
.btn-release {
  width: 100%;
  padding: 11px;
  background: transparent;
  border: 1px solid rgba(201,185,154,0.1);
  color: rgba(232,228,217,0.28);
  font-family: 'Crimson Pro', serif;
  font-size: 13px;
  letter-spacing: 0.08em;
  font-style: italic;
  cursor: pointer;
  transition: all 0.3s;
  border-radius: 4px;
}
.btn-release:hover { border-color: rgba(201,185,154,0.2); color: rgba(232,228,217,0.5); }

/* ===== CHAT ===== */
.chat-screen {
  height: 100%;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, #060d18 0%, #0a0e1a 100%);
  padding-top: 59px;
}
.chat-header {
  padding: 14px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(201,185,154,0.07);
  background: rgba(6,13,24,0.94);
  backdrop-filter: blur(12px);
  flex-shrink: 0;
}
.chat-user {
  display: flex;
  align-items: center;
  gap: 10px;
}
.chat-avatar {
  width: 34px; height: 34px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, #1a3a5c, #0c1828);
  border: 1.5px solid rgba(201,185,154,0.25);
  position: relative;
  overflow: hidden;
}
.chat-avatar::before {
  content: '';
  position: absolute;
  bottom: 4px; left: 50%;
  transform: translateX(-50%);
  width: 7px; height: 14px;
  background: rgba(232,228,217,0.45);
  clip-path: polygon(22% 100%, 78% 100%, 62% 0%, 38% 0%);
}
.chat-avatar::after {
  content: '';
  position: absolute;
  top: 4px; left: 50%;
  transform: translateX(-50%);
  width: 10px; height: 6px;
  background: rgba(196,151,47,0.6);
  border-radius: 2px 2px 0 0;
}
.chat-name { font-size: 14px; color: var(--foam); letter-spacing: 0.04em; }
.chat-status { font-size: 10px; color: var(--sand); opacity: 0.55; font-style: italic; }
.chat-del { font-size: 11px; cursor: pointer; background: none; border: none; color: rgba(232,228,217,0.22); font-family: 'Crimson Pro', serif; letter-spacing: 0.04em; transition: color 0.2s; }
.chat-del:hover { color: rgba(220,100,100,0.55); }

.chat-messages {
  flex: 1;
  padding: 16px 16px 8px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
}
.chat-messages::-webkit-scrollbar { display: none; }
.chat-thread-start {
  text-align: center;
  font-size: 11px;
  color: rgba(232,228,217,0.2);
  font-style: italic;
  letter-spacing: 0.04em;
  margin-bottom: 4px;
}
.msg { max-width: 80%; }
.msg.them { align-self: flex-start; }
.msg.me { align-self: flex-end; }
.msg-bubble {
  padding: 11px 15px;
  font-size: 14.5px;
  line-height: 1.65;
  font-style: italic;
  border-radius: 16px;
}
.msg.them .msg-bubble {
  background: rgba(15,48,92,0.55);
  border: 1px solid rgba(201,185,154,0.1);
  color: rgba(232,228,217,0.88);
  border-bottom-left-radius: 4px;
}
.msg.me .msg-bubble {
  background: rgba(196,151,47,0.14);
  border: 1px solid rgba(196,151,47,0.22);
  color: rgba(232,228,217,0.92);
  border-bottom-right-radius: 4px;
}
.msg-time { font-size: 9.5px; color: rgba(232,228,217,0.18); margin-top: 3px; letter-spacing: 0.04em; padding: 0 4px; }
.msg.me .msg-time { text-align: right; }
.tl-note { font-size: 10px; color: rgba(196,151,47,0.45); font-style: italic; margin-top: 2px; padding-left: 2px; }

.contact-bar {
  margin: 0 14px 10px;
  padding: 10px 14px;
  background: rgba(196,151,47,0.05);
  border: 1px solid rgba(196,151,47,0.14);
  border-radius: 8px;
  font-size: 11.5px;
  color: rgba(196,151,47,0.55);
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  letter-spacing: 0.04em;
  font-style: italic;
  flex-shrink: 0;
}
.contact-bar:hover { background: rgba(196,151,47,0.1); color: rgba(196,151,47,0.9); }

.chat-input-row {
  padding: 10px 14px 30px;
  border-top: 1px solid rgba(201,185,154,0.07);
  background: rgba(6,10,20,0.94);
  backdrop-filter: blur(12px);
  display: flex;
  gap: 10px;
  align-items: flex-end;
  flex-shrink: 0;
}
.chat-input {
  flex: 1;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(201,185,154,0.12);
  border-radius: 20px;
  padding: 11px 16px;
  color: var(--foam);
  font-family: 'Crimson Pro', serif;
  font-size: 14.5px;
  font-style: italic;
  outline: none;
  resize: none;
  min-height: 42px;
  max-height: 90px;
  line-height: 1.5;
}
.chat-input::placeholder { color: rgba(232,228,217,0.2); }
.chat-input:focus { border-color: rgba(201,185,154,0.25); }
.send-btn {
  width: 40px; height: 40px;
  background: rgba(196,151,47,0.18);
  border: 1px solid rgba(196,151,47,0.35);
  border-radius: 50%;
  color: var(--gold);
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.25s;
  flex-shrink: 0;
}
.send-btn:hover { background: rgba(196,151,47,0.3); }

/* ===== PROFILE ===== */
.profile-screen {
  min-height: 100%;
  background: linear-gradient(180deg, #08101e 0%, #0a0e1a 100%);
  padding-bottom: 90px;
  padding-top: 59px;
}
.profile-head {
  padding: 28px 24px 24px;
  text-align: center;
  border-bottom: 1px solid rgba(201,185,154,0.07);
}
.profile-av-large {
  width: 76px; height: 76px;
  border-radius: 50%;
  margin: 0 auto 16px;
  background: radial-gradient(circle at 35% 30%, #1e4a6e, #0d1b2a);
  border: 2px solid rgba(196,151,47,0.4);
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 24px rgba(196,151,47,0.15);
}
.profile-av-large::before {
  content: '';
  position: absolute;
  bottom: 8px; left: 50%;
  transform: translateX(-50%);
  width: 16px; height: 34px;
  background: rgba(232,228,217,0.5);
  clip-path: polygon(22% 100%, 78% 100%, 62% 0%, 38% 0%);
}
.profile-av-large::after {
  content: '';
  position: absolute;
  top: 10px; left: 50%;
  transform: translateX(-50%);
  width: 24px; height: 14px;
  background: rgba(196,151,47,0.8);
  border-radius: 4px 4px 0 0;
  box-shadow: 0 0 20px rgba(196,151,47,0.6);
}
.profile-name-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: 26px;
  font-weight: 300;
  letter-spacing: 0.12em;
  color: var(--foam);
  margin-bottom: 5px;
}
.profile-since { font-size: 11.5px; color: var(--sand); opacity: 0.45; font-style: italic; }

.stats-grid {
  display: flex;
  margin: 24px 18px;
  border: 1px solid rgba(201,185,154,0.1);
  border-radius: 8px;
  overflow: hidden;
}
.stat-cell {
  flex: 1;
  text-align: center;
  padding: 18px 10px;
  border-right: 1px solid rgba(201,185,154,0.08);
}
.stat-cell:last-child { border-right: none; }
.stat-n {
  font-family: 'Cormorant Garamond', serif;
  font-size: 32px;
  font-weight: 300;
  color: var(--gold);
  line-height: 1;
  margin-bottom: 5px;
}
.stat-l { font-size: 10px; color: rgba(232,228,217,0.3); letter-spacing: 0.1em; text-transform: uppercase; }

.lighthouse-section {
  margin: 0 18px;
  padding: 24px;
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(201,185,154,0.08);
  border-radius: 8px;
  text-align: center;
}
.lh-title {
  font-size: 10px;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: rgba(201,185,154,0.4);
  margin-bottom: 20px;
}
.lh-svg-wrap { display: inline-block; position: relative; }
.lh-beam {
  position: absolute;
  top: 22px; left: 50%;
  width: 100px; height: 1.5px;
  background: linear-gradient(90deg, rgba(196,151,47,0.9), transparent);
  transform-origin: left center;
  animation: beamSweep 4s ease-in-out infinite;
  filter: blur(0.5px);
}
@keyframes beamSweep {
  0%{transform:rotate(-55deg);opacity:1;}
  50%{transform:rotate(55deg);opacity:0.8;}
  100%{transform:rotate(-55deg);opacity:1;}
}
.lh-status { font-size: 12.5px; color: var(--gold); margin-top: 14px; font-style: italic; opacity: 0.8; }

.notif-block {
  margin: 16px 18px 0;
  padding: 18px;
  background: rgba(196,151,47,0.05);
  border: 1px solid rgba(196,151,47,0.18);
  border-radius: 8px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
}
.notif-em { font-size: 22px; }
.notif-body { font-size: 13px; line-height: 1.65; color: rgba(232,228,217,0.65); font-style: italic; }
.notif-body strong { color: var(--gold); font-style: normal; }

/* Canvas modal */
.canvas-modal {
  display: none;
  position: absolute;
  inset: 0;
  background: rgba(6,10,20,0.95);
  z-index: 200;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(6px);
  border-radius: 54px;
  overflow: hidden;
}
.canvas-modal.open { display: flex; }
.canvas-box {
  background: var(--parchment);
  border-radius: 6px;
  padding: 16px;
  box-shadow: 0 0 60px rgba(0,0,0,0.6);
}
.canvas-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 16px;
  font-style: italic;
  color: var(--ink);
  text-align: center;
  margin-bottom: 12px;
  opacity: 0.6;
  letter-spacing: 0.06em;
}
#drawCanvas { cursor: crosshair; display: block; border-radius: 3px; }
.canvas-tools {
  display: flex;
  gap: 10px;
  margin-top: 12px;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
}
.cdot {
  width: 24px; height: 24px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid transparent;
  transition: border-color 0.2s;
}
.cdot.sel { border-color: var(--ink); transform: scale(1.15); }
.c-btn {
  padding: 5px 14px;
  background: none;
  border: 1px solid rgba(26,26,46,0.25);
  color: var(--ink);
  font-family: 'Crimson Pro', serif;
  font-size: 13px;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.2s;
}
.c-btn:hover { background: rgba(26,26,46,0.08); }
.c-btn.done-btn { background: var(--ink); color: var(--parchment); border-color: var(--ink); }

/* Send animation overlay */
.send-anim {
  display: none;
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, #040610 0%, #08101e 40%, #0c1e35 70%, #0f2845 100%);
  z-index: 200;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 54px;
  overflow: hidden;
}
.send-anim.show { display: flex; }
.anim-bottle {
  font-size: 48px;
  animation: driftAway 3s ease-in forwards;
  margin-bottom: 24px;
}
@keyframes driftAway {
  0%{transform:translateY(0) rotate(0deg) scale(1); opacity:1;}
  100%{transform:translateY(-180px) translateX(60px) rotate(20deg) scale(0.3); opacity:0;}
}
.anim-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px;
  font-weight: 300;
  font-style: italic;
  color: var(--foam);
  letter-spacing: 0.12em;
  opacity: 0;
  animation: fadeIn 0.8s 0.8s ease-out both;
  text-align: center;
  padding: 0 30px;
}
@keyframes fadeIn { from{opacity:0;transform:translateY(8px);} to{opacity:1;transform:translateY(0);} }
.anim-sub {
  font-size: 13px;
  color: var(--sand);
  opacity: 0;
  font-style: italic;
  margin-top: 8px;
  letter-spacing: 0.06em;
  animation: fadeIn 0.8s 1.4s ease-out both;
}

/* Onboarding screen */
.onboard-screen {
  min-height: 100%;
  background: linear-gradient(180deg, #06111e 0%, #08101e 100%);
  padding-top: 59px;
  padding-bottom: 40px;
}
.onboard-header {
  padding: 24px 24px 0;
  text-align: center;
}
.onboard-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 26px;
  font-weight: 300;
  letter-spacing: 0.1em;
  color: var(--foam);
  margin-bottom: 8px;
  font-style: italic;
}
.onboard-sub { font-size: 13px; color: rgba(232,228,217,0.35); letter-spacing: 0.04em; font-style: italic; }
.onboard-names {
  padding: 28px 18px 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.name-option {
  padding: 16px 20px;
  background: rgba(255,255,255,0.025);
  border: 1px solid rgba(201,185,154,0.12);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.25s;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.name-option:hover {
  background: rgba(196,151,47,0.06);
  border-color: rgba(196,151,47,0.3);
}
.name-option.chosen {
  background: rgba(196,151,47,0.1);
  border-color: rgba(196,151,47,0.5);
}
.name-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: 20px;
  font-weight: 300;
  color: var(--foam);
  letter-spacing: 0.08em;
}
.name-radio {
  width: 18px; height: 18px;
  border: 1.5px solid rgba(201,185,154,0.3);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
}
.name-option.chosen .name-radio {
  border-color: var(--gold);
  background: rgba(196,151,47,0.2);
}
.name-option.chosen .name-radio::after {
  content: '';
  width: 8px; height: 8px;
  background: var(--gold);
  border-radius: 50%;
}
.onboard-note {
  margin: 0 18px;
  font-size: 11px;
  color: rgba(232,228,217,0.22);
  text-align: center;
  font-style: italic;
  letter-spacing: 0.04em;
  line-height: 1.7;
}
.btn-confirm {
  margin: 20px 18px 0;
  width: calc(100% - 36px);
  padding: 14px;
  background: transparent;
  border: 1px solid rgba(196,151,47,0.4);
  color: var(--gold);
  font-family: 'Cormorant Garamond', serif;
  font-size: 17px;
  font-weight: 300;
  letter-spacing: 0.18em;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.3s;
}
.btn-confirm:hover { background: rgba(196,151,47,0.08); border-color: var(--gold); }

/* scrollbar */
.screen::-webkit-scrollbar { display: none; }
* { -webkit-tap-highlight-color: transparent; }

/* V2 */
@keyframes wave1 { 0%,100%{transform:translateX(0) scaleY(1);} 50%{transform:translateX(8%) scaleY(1.1);} }
@keyframes wave2 { 0%,100%{transform:translateX(0) scaleY(1);} 50%{transform:translateX(-5%) scaleY(1.08);} }
@keyframes wave3 { 0%,100%{transform:translateX(0) scaleY(1);} 50%{transform:translateX(4%) scaleY(1.05);} }
.global-beam{position:absolute;inset:0;pointer-events:none;z-index:1;border-radius:54px;overflow:hidden;}
.global-beam::before{content:'';position:absolute;top:20%;left:10%;width:200%;height:4px;background:linear-gradient(90deg,rgba(196,151,47,0.07),rgba(196,151,47,0.02),transparent);transform-origin:left center;animation:globalBeamSweep 18s ease-in-out infinite;filter:blur(8px);border-radius:4px;}
@keyframes globalBeamSweep{0%{transform:rotate(-30deg);opacity:0;}15%{opacity:1;}50%{transform:rotate(30deg);opacity:0.6;}85%{opacity:1;}100%{transform:rotate(-30deg);opacity:0;}}
.map-screen{height:100%;background:linear-gradient(180deg,#040c16 0%,#060e1a 100%);display:flex;flex-direction:column;padding-top:59px;}
.map-header{padding:18px 20px 12px;display:flex;align-items:baseline;justify-content:space-between;flex-shrink:0;}
.map-title{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:300;letter-spacing:0.12em;color:var(--foam);}
.map-subtitle{font-size:11px;color:rgba(100,200,120,0.7);letter-spacing:0.06em;font-style:italic;animation:mapPulse 3s infinite;}
@keyframes mapPulse{0%,100%{opacity:0.7;}50%{opacity:1;}}
.map-canvas-wrap{position:relative;flex-shrink:0;}
#worldMap{display:block;width:100%;height:auto;}
.map-legend{position:absolute;bottom:8px;left:14px;display:flex;gap:12px;}
.legend-item{display:flex;align-items:center;gap:5px;font-size:9px;color:rgba(232,228,217,0.35);letter-spacing:0.06em;}
.legend-dot{width:6px;height:6px;border-radius:50%;}
.legend-dot.active{background:rgba(196,151,47,0.9);box-shadow:0 0 6px rgba(196,151,47,0.6);}
.legend-dot.storm{background:rgba(100,150,255,0.7);box-shadow:0 0 6px rgba(100,150,255,0.4);}
.legend-dot.drift{background:rgba(232,228,217,0.5);}
.map-you-section{padding:14px 20px;border-top:1px solid rgba(201,185,154,0.07);border-bottom:1px solid rgba(201,185,154,0.07);flex-shrink:0;}
.map-you-label{font-size:9px;letter-spacing:0.2em;text-transform:uppercase;color:rgba(201,185,154,0.35);margin-bottom:5px;}
.map-you-stat{font-size:13px;color:rgba(232,228,217,0.55);font-style:italic;line-height:1.5;}
.map-you-stat strong{color:var(--gold);font-style:normal;}
.map-recent{padding:14px 20px;flex:1;overflow:hidden;}
.map-recent-label{font-size:9px;letter-spacing:0.2em;text-transform:uppercase;color:rgba(201,185,154,0.3);margin-bottom:12px;}
.map-beacons{display:flex;flex-direction:column;gap:8px;}
.beacon-row{display:flex;align-items:center;gap:10px;padding:10px 12px;background:rgba(255,255,255,0.02);border:1px solid rgba(201,185,154,0.07);border-radius:8px;}
.beacon-dot-live{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.beacon-name{font-size:13px;color:rgba(232,228,217,0.6);font-style:italic;flex:1;}
.beacon-loc{font-size:10px;color:rgba(201,185,154,0.35);letter-spacing:0.04em;}
.beacon-dist{font-size:10px;color:rgba(196,151,47,0.5);font-style:italic;}
.write-options-block{margin:0 18px 4px;padding:18px;background:rgba(255,255,255,0.015);border:1px solid rgba(201,185,154,0.08);border-radius:6px;}
.write-opt-label{font-size:9px;letter-spacing:0.22em;text-transform:uppercase;color:rgba(201,185,154,0.35);margin-bottom:10px;}
.tone-pills{display:flex;gap:7px;flex-wrap:wrap;}
.tone-pill{padding:7px 14px;background:transparent;border:1px solid rgba(201,185,154,0.14);border-radius:20px;color:rgba(232,228,217,0.4);font-family:'Crimson Pro',serif;font-size:12.5px;font-style:italic;letter-spacing:0.04em;cursor:pointer;transition:all 0.25s;}
.tone-pill.active{border-color:rgba(196,151,47,0.6);background:rgba(196,151,47,0.1);color:var(--gold);}
.tone-pill:hover:not(.active){border-color:rgba(201,185,154,0.3);color:rgba(232,228,217,0.7);}
.dest-options{display:flex;gap:10px;}
.dest-opt{flex:1;padding:12px 10px;border:1px solid rgba(201,185,154,0.1);border-radius:8px;text-align:center;cursor:pointer;transition:all 0.25s;background:transparent;}
.dest-opt.active{border-color:rgba(196,151,47,0.45);background:rgba(196,151,47,0.07);}
.dest-icon{font-size:20px;margin-bottom:4px;}
.dest-name{font-size:13px;color:rgba(232,228,217,0.7);font-style:italic;letter-spacing:0.04em;}
.dest-sub{font-size:10px;color:rgba(201,185,154,0.35);letter-spacing:0.04em;margin-top:2px;}
.region-picker{margin-top:12px;}
.region-select{width:100%;padding:10px 14px;background:rgba(255,255,255,0.04);border:1px solid rgba(201,185,154,0.15);border-radius:6px;color:rgba(232,228,217,0.6);font-family:'Crimson Pro',serif;font-size:14px;font-style:italic;outline:none;appearance:none;cursor:pointer;}
.region-select option{background:#0d1b2a;color:var(--foam);}
.send-anim{display:none;position:absolute;inset:0;z-index:200;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(180deg,#020610 0%,#040c18 40%,#081830 70%,#0a1f3a 100%);border-radius:54px;overflow:hidden;}
.send-anim.show{display:flex;}
.sa-stars{position:absolute;inset:0;pointer-events:none;}
.sa-ocean{position:absolute;bottom:0;left:0;width:100%;height:30%;pointer-events:none;}
.sa-wave{position:absolute;width:220%;left:-60%;border-radius:50%;}
.sa-w1{bottom:0;height:120px;background:radial-gradient(ellipse at 50% 100%,#0e3158,#081525);animation:wave1 8s ease-in-out infinite;}
.sa-w2{bottom:20px;height:100px;background:radial-gradient(ellipse at 40% 100%,rgba(12,35,65,0.7),transparent);animation:wave2 10s ease-in-out infinite reverse;}
.sa-bottle{animation:bottleFlySend 3s cubic-bezier(0.25,0.1,0.25,1) forwards;margin-bottom:32px;position:relative;z-index:2;}
@keyframes bottleFlySend{0%{transform:translateY(60px) translateX(0) rotate(0deg) scale(1);opacity:1;}30%{transform:translateY(20px) translateX(15px) rotate(8deg) scale(1.05);opacity:1;}100%{transform:translateY(-220px) translateX(80px) rotate(25deg) scale(0.2);opacity:0;}}
.sa-content{text-align:center;padding:0 32px;position:relative;z-index:2;}
.sa-title{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:300;letter-spacing:0.18em;color:var(--foam);opacity:0;animation:fadeUp 0.7s 0.6s ease-out both;margin-bottom:10px;}
.sa-sub{font-size:13px;color:var(--sand);font-style:italic;opacity:0;animation:fadeUp 0.7s 1s ease-out both;letter-spacing:0.06em;margin-bottom:16px;}
.sa-tone-badge{display:inline-block;padding:5px 16px;border:1px solid rgba(196,151,47,0.3);border-radius:20px;font-size:11px;color:rgba(196,151,47,0.7);font-style:italic;letter-spacing:0.1em;opacity:0;animation:fadeUp 0.7s 1.3s ease-out both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.lh-level-row{display:flex;justify-content:center;align-items:center;gap:14px;margin-bottom:16px;}
.lh-level-badge{padding:4px 14px;border:1px solid rgba(196,151,47,0.45);border-radius:20px;font-size:11px;color:var(--gold);letter-spacing:0.12em;text-transform:uppercase;}
.lh-streak{font-size:12px;color:rgba(232,228,217,0.5);font-style:italic;}
.lh-xp-wrap{margin:16px 0 10px;}
.lh-xp-bar{height:3px;background:rgba(201,185,154,0.1);border-radius:2px;overflow:hidden;margin-bottom:7px;}
.lh-xp-fill{height:100%;background:linear-gradient(90deg,rgba(196,151,47,0.6),rgba(196,151,47,1));border-radius:2px;transition:width 0.5s ease;}
.lh-xp-label{font-size:10px;color:rgba(201,185,154,0.35);letter-spacing:0.06em;font-style:italic;}
.lh-reached{font-size:13px;color:rgba(232,228,217,0.45);font-style:italic;line-height:1.6;margin:12px 0 8px;}
.lh-reached strong{color:var(--gold);font-style:normal;}
.save-line-btn{display:flex;align-items:center;gap:7px;margin:10px 18px 0;padding:9px 16px;background:transparent;border:1px solid rgba(201,185,154,0.12);border-radius:20px;color:rgba(201,185,154,0.45);font-family:'Crimson Pro',serif;font-size:12px;font-style:italic;letter-spacing:0.06em;cursor:pointer;transition:all 0.3s;width:calc(100% - 36px);justify-content:center;}
.save-line-btn:hover{border-color:rgba(196,151,47,0.3);color:rgba(196,151,47,0.7);}
.save-line-btn.saved{border-color:rgba(196,151,47,0.5);color:var(--gold);}
.moments-screen{min-height:100%;background:linear-gradient(160deg,#06111e 0%,#080f1c 100%);padding-top:59px;padding-bottom:40px;}
.moments-intro{padding:8px 20px 20px;font-size:13px;color:rgba(232,228,217,0.3);font-style:italic;letter-spacing:0.04em;}
.moments-list{padding:0 18px;display:flex;flex-direction:column;gap:12px;}
.moment-card{padding:20px 22px;background:var(--parchment);border-radius:4px;box-shadow:0 4px 20px rgba(0,0,0,0.35);position:relative;overflow:hidden;}
.moment-card::before{content:'"';position:absolute;top:-4px;left:10px;font-family:'Cormorant Garamond',serif;font-size:72px;color:rgba(26,26,46,0.07);line-height:1;pointer-events:none;}
.moment-text{font-family:'Crimson Pro',serif;font-size:16px;line-height:1.7;color:var(--ink);font-style:italic;position:relative;z-index:1;}
.moment-meta{display:flex;justify-content:space-between;margin-top:12px;padding-top:10px;border-top:1px solid rgba(201,185,154,0.3);}
.moment-from{font-size:11px;color:rgba(26,26,46,0.4);font-style:italic;}
.moment-date{font-size:10px;color:rgba(26,26,46,0.3);letter-spacing:0.04em;}
.profile-nav-link{margin:0 18px 16px;padding:14px 18px;background:rgba(255,255,255,0.02);border:1px solid rgba(201,185,154,0.08);border-radius:8px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-family:'Crimson Pro',serif;font-size:14px;font-style:italic;color:rgba(232,228,217,0.55);letter-spacing:0.04em;transition:all 0.2s;}
.profile-nav-link:hover{background:rgba(196,151,47,0.04);border-color:rgba(196,151,47,0.2);color:rgba(232,228,217,0.8);}
.pnl-count{font-size:11px;color:rgba(196,151,47,0.6);font-style:normal;}
.chat-messages{position:relative;}
.chat-messages::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent 0px,transparent 38px,rgba(15,52,96,0.04) 38px,rgba(15,52,96,0.04) 39px);pointer-events:none;z-index:0;}
.msg,.typing-indicator,.chat-thread-start{position:relative;z-index:1;}
.typing-indicator{align-self:flex-start;}
.typing-bubble{display:inline-flex;gap:4px;align-items:center;padding:12px 16px;background:rgba(15,48,92,0.55);border:1px solid rgba(201,185,154,0.1);border-radius:16px;border-bottom-left-radius:4px;}
.typing-bubble span{width:5px;height:5px;background:rgba(232,228,217,0.4);border-radius:50%;animation:typingDot 1.2s infinite ease-in-out;}
.typing-bubble span:nth-child(2){animation-delay:0.2s;}
.typing-bubble span:nth-child(3){animation-delay:0.4s;}
@keyframes typingDot{0%,60%,100%{transform:translateY(0);opacity:0.4;}30%{transform:translateY(-5px);opacity:1;}}
.react-btn{position:absolute;bottom:-8px;right:8px;width:22px;height:22px;border-radius:50%;background:rgba(10,14,26,0.9);border:1px solid rgba(201,185,154,0.15);color:rgba(201,185,154,0.35);font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:all 0.2s;}
.msg-bubble{position:relative;}
.msg-bubble:hover .react-btn{opacity:1;}
.react-btn.reacted{color:var(--gold);border-color:rgba(196,151,47,0.4);opacity:1 !important;}
.react-float{position:absolute;color:var(--gold);font-size:14px;pointer-events:none;animation:floatAway 1s ease-out forwards;bottom:0;right:8px;}
@keyframes floatAway{0%{opacity:1;transform:translateY(0);}100%{opacity:0;transform:translateY(-28px);}}
.wave-btn{width:40px;height:40px;border-radius:50%;background:rgba(15,52,96,0.4);border:1px solid rgba(201,185,154,0.15);color:rgba(201,185,154,0.5);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.25s;flex-shrink:0;}
.wave-btn:hover{background:rgba(15,52,96,0.7);border-color:rgba(201,185,154,0.35);color:rgba(201,185,154,0.9);}
.wave-msg{font-size:13px !important;color:rgba(232,228,217,0.55) !important;font-style:italic;letter-spacing:0.04em;}
.depth-hint{text-align:center;font-size:10.5px;color:rgba(196,151,47,0.35);font-style:italic;letter-spacing:0.08em;padding:4px 20px;position:relative;}
.depth-hint::before,.depth-hint::after{content:'';position:absolute;top:50%;width:25%;height:1px;background:linear-gradient(90deg,transparent,rgba(196,151,47,0.15));}
.depth-hint::before{left:10%;}
.depth-hint::after{right:10%;background:linear-gradient(270deg,transparent,rgba(196,151,47,0.15));}
.transit-screen{height:100%;background:linear-gradient(180deg,#030810 0%,#060e1a 40%,#0a1828 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;padding-top:59px;}
.transit-ocean{position:absolute;bottom:0;left:0;width:100%;height:40%;pointer-events:none;}
.transit-wave{position:absolute;width:220%;left:-60%;border-radius:50%;}
.tw1{bottom:0;height:160px;background:radial-gradient(ellipse at 50% 100%,#0e3158,#060e1a);animation:wave1 9s ease-in-out infinite;}
.tw2{bottom:25px;height:130px;background:radial-gradient(ellipse at 40% 100%,rgba(12,35,65,0.6),transparent);animation:wave2 11s ease-in-out infinite reverse;}
.tw3{bottom:45px;height:110px;background:radial-gradient(ellipse at 60% 100%,rgba(10,28,55,0.4),transparent);animation:wave3 13s ease-in-out infinite;}
.transit-bottle-wrap{position:relative;z-index:5;margin-bottom:40px;}
.transit-bottle{animation:transitDrift 6s ease-in-out infinite;filter:drop-shadow(0 12px 28px rgba(0,0,0,0.6));}
@keyframes transitDrift{0%,100%{transform:translateX(0) rotate(-6deg) translateY(0);}33%{transform:translateX(14px) rotate(3deg) translateY(-12px);}66%{transform:translateX(-10px) rotate(-9deg) translateY(6px);}}
.transit-content{text-align:center;padding:0 32px;position:relative;z-index:5;}
.transit-label{font-size:10px;letter-spacing:0.3em;text-transform:uppercase;color:rgba(201,185,154,0.3);margin-bottom:8px;}
.transit-title{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;font-style:italic;color:var(--foam);letter-spacing:0.1em;margin-bottom:24px;opacity:0.85;}
.transit-timer-wrap{margin-bottom:12px;}
.transit-timer-bar{height:2px;background:rgba(201,185,154,0.1);border-radius:2px;overflow:hidden;margin-bottom:8px;}
.transit-timer-fill{height:100%;background:linear-gradient(90deg,rgba(196,151,47,0.4),rgba(196,151,47,0.8));border-radius:2px;width:15%;animation:timerGrow 8s linear infinite alternate;}
@keyframes timerGrow{from{width:8%;}to{width:35%;}}
.transit-eta{font-size:12px;color:rgba(201,185,154,0.4);font-style:italic;letter-spacing:0.04em;}
.transit-coord{font-size:10px;color:rgba(201,185,154,0.2);letter-spacing:0.15em;font-family:-apple-system,monospace;margin-top:6px;animation:coordUpdate 5s infinite;}
@keyframes coordUpdate{0%,90%{opacity:0.5;}95%{opacity:0;}100%{opacity:0.5;}}
.transit-home-btn{position:absolute;bottom:100px;left:50%;transform:translateX(-50%);padding:10px 28px;background:transparent;border:1px solid rgba(201,185,154,0.15);border-radius:20px;color:rgba(232,228,217,0.35);font-family:'Crimson Pro',serif;font-size:13px;font-style:italic;letter-spacing:0.06em;cursor:pointer;transition:all 0.3s;white-space:nowrap;}
.transit-home-btn:hover{color:rgba(232,228,217,0.65);border-color:rgba(201,185,154,0.3);}
.tab-bar{padding:8px 0 26px;} .tab-item{font-size:8.5px;}
.tab-icon-wrap{position:relative;display:inline-block;}
</style>
</head>
<body>

<div class="page-brand">
  <h1>harbor</h1>
  <p>letters that find their way</p>
</div>

<div class="nav-pills">
  <button class="active" onclick="show('splash')">Splash</button>
  <button onclick="show('onboard')">Identity</button>
  <button onclick="show('home')">Inbox</button>
  <button onclick="show('write')">Write</button>
  <button onclick="show('read')">Read Letter</button>
  <button onclick="show('chat')">Chat</button>
  <button onclick="show('profile')">Profile</button>
  <button onclick="show('map')">Map</button>
  <button onclick="show('transit')">Transit</button>
  <button onclick="show('moments')">Moments</button>
</div>

<!-- iPhone Frame -->
<div class="iphone-wrapper">
  <div class="iphone-screen">
    <div class="global-beam" id="globalBeam"></div>
    <div class="dynamic-island"></div>

    <!-- Status bar -->
    <div class="status-bar">
      <div class="status-time">9:41</div>
      <div class="status-icons">
        <svg width="17" height="12" viewBox="0 0 17 12" fill="none">
          <rect x="0" y="3" width="3" height="9" rx="1" fill="white" opacity="0.4"/>
          <rect x="4.5" y="2" width="3" height="10" rx="1" fill="white" opacity="0.6"/>
          <rect x="9" y="0.5" width="3" height="11.5" rx="1" fill="white" opacity="0.8"/>
          <rect x="13.5" y="0" width="3" height="12" rx="1" fill="white"/>
        </svg>
        <svg width="16" height="12" viewBox="0 0 16 12" fill="white">
          <path d="M8 2.4C10.2 2.4 12.2 3.3 13.6 4.8L15 3.4C13.2 1.6 10.7 0.5 8 0.5C5.3 0.5 2.8 1.6 1 3.4L2.4 4.8C3.8 3.3 5.8 2.4 8 2.4Z" opacity="0.4"/>
          <path d="M8 5.2C9.5 5.2 10.9 5.8 11.9 6.8L13.3 5.4C11.9 4.1 10 3.3 8 3.3C6 3.3 4.1 4.1 2.7 5.4L4.1 6.8C5.1 5.8 6.5 5.2 8 5.2Z" opacity="0.7"/>
          <circle cx="8" cy="10" r="1.5"/>
        </svg>
        <svg width="25" height="12" viewBox="0 0 25 12" fill="none">
          <rect x="0.5" y="0.5" width="21" height="11" rx="3.5" stroke="white" stroke-opacity="0.35"/>
          <rect x="22" y="3.5" width="2.5" height="5" rx="1.25" fill="white" fill-opacity="0.4"/>
          <rect x="2" y="2" width="16" height="8" rx="2" fill="white"/>
        </svg>
      </div>
    </div>

    <div class="screens-container">

      <!-- SPLASH -->
      <div id="splash" class="screen active">
        <div class="splash" style="height:852px;">
          <div class="splash-stars" id="starsEl"></div>
          <div class="splash-waves">
            <div class="splash-wave w1"></div>
            <div class="splash-wave w2"></div>
            <div class="splash-wave w3"></div>
          </div>
          <div class="ocean-shimmer">
            <div class="shimmer-line" style="top:20%;width:60%;left:20%;--sd:5s;--ss:0s;"></div>
            <div class="shimmer-line" style="top:45%;width:40%;left:30%;--sd:4s;--ss:1.5s;"></div>
            <div class="shimmer-line" style="top:70%;width:70%;left:10%;--sd:6s;--ss:0.8s;"></div>
          </div>
          <div class="bottle-float">
            <svg width="44" height="110" viewBox="0 0 44 110" fill="none" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="glass" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="rgba(150,200,220,0.15)"/>
                  <stop offset="35%" stop-color="rgba(200,240,255,0.35)"/>
                  <stop offset="65%" stop-color="rgba(150,200,220,0.2)"/>
                  <stop offset="100%" stop-color="rgba(100,160,190,0.1)"/>
                </linearGradient>
                <linearGradient id="water" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="rgba(15,52,96,0.8)"/>
                  <stop offset="100%" stop-color="rgba(10,35,65,0.9)"/>
                </linearGradient>
              </defs>
              <!-- Cork -->
              <rect x="16" y="2" width="12" height="10" rx="3" fill="rgba(160,120,70,0.8)" stroke="rgba(140,100,50,0.5)" stroke-width="0.5"/>
              <!-- Neck -->
              <path d="M17 12 L15 26 L29 26 L27 12 Z" fill="url(#glass)" stroke="rgba(180,220,240,0.3)" stroke-width="0.5"/>
              <path d="M17 12 L16 26 L17 26 L18 12 Z" fill="rgba(220,240,255,0.15)"/>
              <!-- Body -->
              <path d="M15 26 Q6 30 5 45 L5 80 Q5 98 22 98 Q39 98 39 80 L39 45 Q38 30 29 26 Z"
                fill="url(#glass)" stroke="rgba(180,220,240,0.3)" stroke-width="0.5"/>
              <!-- Water inside -->
              <path d="M6.5 55 Q6 60 6 70 L6 80 Q6 95 22 95 Q38 95 38 80 L38 70 Q38 60 37.5 55 Z"
                fill="url(#water)" opacity="0.7"/>
              <!-- Letter scroll -->
              <rect x="14" y="42" width="16" height="11" rx="1" fill="rgba(245,240,232,0.7)" transform="rotate(-3 14 42)"/>
              <line x1="16" y1="45" x2="27" y2="45" stroke="rgba(26,26,46,0.25)" stroke-width="0.8"/>
              <line x1="16" y1="48" x2="26" y2="48" stroke="rgba(26,26,46,0.2)" stroke-width="0.8"/>
              <!-- Glass highlights -->
              <path d="M9 35 Q8 55 8 70" stroke="rgba(200,240,255,0.2)" stroke-width="1.5" fill="none" stroke-linecap="round"/>
              <path d="M12 28 Q11 32 11 38" stroke="rgba(200,240,255,0.15)" stroke-width="1" fill="none" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="splash-content">
            <div class="splash-wordmark">harbor</div>
            <div class="splash-tagline">letters that find their way</div>
          </div>
          <div class="splash-cta">
            <button class="btn-begin" onclick="show('onboard')">Begin</button>
            <div class="splash-hint">anonymous Â· borderless Â· between people</div>
          </div>
        </div>
      </div>

      <!-- ONBOARD -->
      <div id="onboard" class="screen">
        <div class="onboard-screen">
          <div class="onboard-header">
            <div style="font-size:32px;margin-bottom:12px;">ðŸ®</div>
            <div class="onboard-title">Choose your name</div>
            <div class="onboard-sub">This will be your identity â€” it cannot be changed</div>
          </div>
          <div class="onboard-names">
            <div class="name-option chosen" onclick="pickName(this)">
              <span class="name-text">Misty Shore</span>
              <div class="name-radio"></div>
            </div>
            <div class="name-option" onclick="pickName(this)">
              <span class="name-text">Northern Flame</span>
              <div class="name-radio"></div>
            </div>
            <div class="name-option" onclick="pickName(this)">
              <span class="name-text">Lunar Tide</span>
              <div class="name-radio"></div>
            </div>
            <div class="name-option" onclick="pickName(this)">
              <span class="name-text">Hollow Crest</span>
              <div class="name-radio"></div>
            </div>
            <div class="name-option" onclick="pickName(this)">
              <span class="name-text">Silver Harbour</span>
              <div class="name-radio"></div>
            </div>
          </div>
          <div class="onboard-note">
            Your name is your only identity on Harbor.<br>
            No email. No real name. Just the sea.
          </div>
          <button class="btn-confirm" onclick="show('home')">âŸ¿ Set sail</button>
        </div>
      </div>

      <!-- HOME -->
      <div id="home" class="screen">
        <div class="home-screen">
          <div class="home-header">
            <div class="home-logo">harbor</div>
            <div class="avatar-btn" onclick="show('profile')">
              <div class="avatar-circle">
                <div class="avatar-lh"></div>
                <div class="avatar-top"></div>
              </div>
              <span class="avatar-name">Misty Shore</span>
            </div>
          </div>

          <div class="inbox-section">
            <div class="inbox-label">Today's letters</div>
          </div>

          <div class="new-letter-banner" onclick="show('read')">
            <div class="new-badge">
              <div class="new-badge-dot"></div>
              New letter arrived
            </div>
            <div class="banner-preview">"I don't know who you are. But today I felt like writing to someone who doesn't know me at all..."</div>
            <div class="banner-meta">
              <div class="banner-from">â€” Northern Flame Â· ðŸŒ from Italian</div>
              <div class="banner-arrow">â€º</div>
            </div>
          </div>

          <div class="inbox-section" style="padding-top:8px;">
            <div class="inbox-label">Previous</div>
          </div>

          <div class="letter-card" onclick="show('read')">
            <div class="lc-top">
              <div class="lc-from">Hollow Crest</div>
              <div class="lc-date">Feb 26</div>
            </div>
            <div class="lc-preview">"...the city never goes quiet here. but some nights I find a corner and it's almost like silence..."</div>
          </div>

          <div class="letter-card unread" onclick="show('read')">
            <div class="lc-top">
              <div class="lc-from">Lunar Tide <span class="lc-unread-dot"></span></div>
              <div class="lc-date">Feb 24</div>
            </div>
            <div class="lc-preview">"Have you ever wanted to disappear, not from life, but just from being known?"</div>
          </div>

          <div class="letter-card" onclick="show('read')">
            <div class="lc-top">
              <div class="lc-from">Silver Harbour</div>
              <div class="lc-date">Feb 22</div>
            </div>
            <div class="lc-preview">"My grandmother used to write letters to people she'd never meet. I think I understand her now."</div>
          </div>

          <button class="send-another-btn">ðŸ“¬ Send me another letter</button>

          <div class="write-fab" onclick="show('write')">âœ¦</div>

          <div class="tab-bar">
            <div class="tab-item active"><span class="tab-icon-wrap"><span class="tab-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><path d="M3 8 L12 13 L21 8"/><rect x="3" y="6" width="18" height="13" rx="2"/></svg></span></span>Letters</div>
            <div class="tab-item" onclick="show('map')"><span class="tab-icon-wrap"><span class="tab-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M3 12 Q7 8 12 12 Q17 16 21 12"/><path d="M12 3 Q8 7 12 12 Q16 17 12 21"/></svg></span></span>Map</div>
            <div class="tab-item" onclick="show('chat')"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ”¦</span></span>Chats</div>
            <div class="tab-item" onclick="show('profile')"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ®</span></span>Profile</div>
          </div>
        </div>
      </div>

      <!-- WRITE -->
      <div id="write" class="screen">
        <div class="write-screen">
          <div class="write-header">
            <button class="back-btn" onclick="show('home')">â†</button>
            <div class="write-title">A letter to the ocean</div>
          </div>
          <div style="padding: 0 0 0 0;">
            <div style="padding: 0 18px; margin-top:20px;">
              <div class="paper-wrap">
                <div class="paper-top"></div>
                <div class="paper-inner">
                  <textarea class="letter-textarea" id="letterText" placeholder="Write whatever you wish. This letter will find the one who needs it..." oninput="updateChar()"></textarea>
                </div>
                <div class="paper-footer">
                  <span class="char-count" id="charCount">0 characters</span>
                  <button class="draw-pill" onclick="openCanvas()">âœ Add sketch</button>
                </div>
              </div>
            </div>
            <div class="write-options-block">
              <div class="write-opt-label">tone of your letter</div>
              <div class="tone-pills" id="tonePills">
                <button class="tone-pill active" data-tone="melancholy" onclick="selectTone(this)">melancholy</button>
                <button class="tone-pill" data-tone="hopeful" onclick="selectTone(this)">hopeful</button>
                <button class="tone-pill" data-tone="confessional" onclick="selectTone(this)">confessional</button>
                <button class="tone-pill" data-tone="playful" onclick="selectTone(this)">playful</button>
              </div>
              <div class="write-opt-label" style="margin-top:16px;">send towards</div>
              <div class="dest-options" id="destOptions">
                <div class="dest-opt active" data-dest="sea" onclick="selectDest(this)">
                  <div class="dest-icon">ðŸŒŠ</div>
                  <div class="dest-name">Open sea</div>
                  <div class="dest-sub">fully random</div>
                </div>
                <div class="dest-opt" data-dest="shore" onclick="selectDest(this)">
                  <div class="dest-icon">ðŸ”</div>
                  <div class="dest-name">A shore</div>
                  <div class="dest-sub">choose region</div>
                </div>
              </div>
              <div class="region-picker" id="regionPicker" style="display:none;">
                <select class="region-select" id="regionSelect">
                  <option value="">Select a regionâ€¦</option>
                  <option>Northern Europe</option>
                  <option>Southern Europe</option>
                  <option>East Asia</option>
                  <option>South Asia</option>
                  <option>North America</option>
                  <option>South America</option>
                  <option>Middle East</option>
                  <option>Africa</option>
                  <option>Oceania</option>
                </select>
              </div>
            </div>
            <div class="write-footer">
              <div class="send-note">
                Your letter will be <em>reviewed</em> and drift to a stranger.<br>
                You will never know who receives it.
              </div>
              <button class="btn-send" onclick="triggerSendAnim()">
                <span>âŸ¿</span> Send to sea
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- READ -->
      <div id="read" class="screen">
        <div class="read-screen">
          <div class="read-header">
            <button class="back-btn" onclick="show('home')">â†</button>
            <div class="read-from">from Northern Flame</div>
            <button class="report-btn">âš‘ Report</button>
          </div>
          <div class="translation-bar">ðŸŒ Auto-translated from Italian</div>
          <button class="save-line-btn" id="saveLineBtn" onclick="saveMoment()">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"><polygon points="7,1 8.8,5.2 13.5,5.5 10,8.5 11.1,13.2 7,10.5 2.9,13.2 4,8.5 0.5,5.5 5.2,5.2"/></svg>
            Save a line
          </button>
          <div class="letter-paper" style="margin-top:14px;">
            <div class="letter-paper-top"></div>
            <div class="letter-paper-inner">
              <div class="letter-text">
                I don't know who you are. But today I felt like writing to someone who doesn't know me at all â€” no history, no expectations.<br><br>
                I live by the sea. Every morning I step out onto the balcony and listen to it breathe. Sometimes I feel like it knows something I don't. Something important.<br><br>
                Do you ever just listen to something, with no particular reason?
              </div>
              <div class="letter-sketch">
                <div class="sketch-placeholder">âœ a pencil sketch of waves</div>
              </div>
              <div class="letter-sig">â€” Northern Flame, Italy</div>
            </div>
          </div>
          <div class="letter-actions" style="margin-top:14px;">
            <button class="btn-reply" onclick="show('chat')">Reply â†’ begin a conversation</button>
            <button class="btn-release">Release this letter</button>
          </div>
        </div>
      </div>

      <!-- CHAT -->
      <div id="chat" class="screen">
        <div class="chat-screen">
          <div class="chat-header">
            <div class="chat-user">
              <button class="back-btn" onclick="show('home')" style="margin-right:2px;">â†</button>
              <div class="chat-avatar"></div>
              <div>
                <div class="chat-name">Northern Flame</div>
                <div class="chat-status">online Â· Italy</div>
              </div>
            </div>
            <button class="chat-del">Delete chat</button>
          </div>
          <div class="chat-messages" id="chatMsgs">
            <div class="chat-thread-start">Conversation started â€” from your letter, Feb 28</div>
            <div class="msg them">
              <div class="msg-bubble">You actually replied. I honestly didn't expect that.</div>
              <div class="tl-note">ðŸŒ translated from Italian</div>
              <div class="msg-time">14:23</div>
            </div>
            <div class="msg me">
              <div class="msg-bubble">Your letter about the sea â€” I read it twice. There's no sea near my city, only rivers. But I understood what you meant.</div>
              <div class="msg-time">14:27</div>
            </div>
            <div class="msg them">
              <div class="msg-bubble">Rivers breathe too. In their own way.</div>
              <div class="tl-note">ðŸŒ translated from Italian</div>
              <div class="msg-time">14:31</div>
            </div>
            <div class="msg me">
              <div class="msg-bubble">Yes. You're right. I hadn't thought of it like that.</div>
              <div class="msg-time">14:33</div>
            </div>
            <div class="msg them">
              <div class="msg-bubble">Do you live near a river? Is it large?</div>
              <div class="tl-note">ðŸŒ translated from Italian</div>
              <div class="msg-time">14:36</div>
            </div>
            <div class="typing-indicator" id="typingIndicator" style="display:none;">
              <div class="typing-bubble"><span></span><span></span><span></span></div>
              <div class="tl-note">Northern Flame is writingâ€¦</div>
            </div>
          </div>
          <div class="contact-bar">âš“ Exchange contacts to connect beyond Harbor</div>
          <div class="chat-input-row">
            <textarea class="chat-input" id="chatInput" placeholder="Write something..." rows="1" onkeydown="handleChatKey(event)"></textarea>
            <button class="wave-btn" onclick="sendWave()" title="Send a wave">
              <svg width="18" height="14" viewBox="0 0 18 14" fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"><path d="M1 7 Q3 3 5 7 Q7 11 9 7 Q11 3 13 7 Q15 11 17 7"/></svg>
            </button>
            <button class="send-btn" onclick="sendChatMsg()">â†’</button>
          </div>
        </div>
      </div>

      <!-- PROFILE -->
      <div id="profile" class="screen">
        <div class="profile-screen">
          <div style="padding: 16px 18px 0; display:flex; justify-content:flex-start;">
            <button class="back-btn" onclick="show('home')">â†</button>
          </div>
          <div class="profile-head">
            <div class="profile-av-large"></div>
            <div class="profile-name-text">Misty Shore</div>
            <div class="profile-since">with you since January 2026</div>
          </div>
          <div class="stats-grid">
            <div class="stat-cell"><div class="stat-n">14</div><div class="stat-l">Sent</div></div>
            <div class="stat-cell"><div class="stat-n">19</div><div class="stat-l">Received</div></div>
            <div class="stat-cell"><div class="stat-n">6</div><div class="stat-l">Replied</div></div>
          </div>
          <div class="profile-nav-link" onclick="show('moments')">
            <span>âœ¦ Collected Lines</span>
            <span class="pnl-count" id="momentsCount">3 saved</span>
          </div>
          <div class="lighthouse-section">
            <div class="lh-title">Your Lighthouse</div>
            <div class="lh-level-row">
              <div class="lh-level-badge" id="lhLevelBadge">Level 4</div>
              <div class="lh-streak" id="lhStreak">ðŸ”¥ 3 day streak</div>
            </div>
            <div class="lh-svg-wrap">
              <svg width="60" height="90" viewBox="0 0 60 90" fill="none">
                <rect x="15" y="80" width="30" height="6" rx="2" fill="rgba(201,185,154,0.25)"/>
                <path d="M24 36 L22 80 L38 80 L36 36 Z" fill="rgba(232,228,217,0.12)" stroke="rgba(232,228,217,0.25)" stroke-width="0.8"/>
                <rect x="23" y="53" width="14" height="7" rx="1" fill="rgba(196,151,47,0.15)"/>
                <rect x="23" y="67" width="14" height="7" rx="1" fill="rgba(196,151,47,0.15)"/>
                <rect x="19" y="26" width="22" height="13" rx="2" fill="rgba(196,151,47,0.28)" stroke="rgba(196,151,47,0.5)" stroke-width="0.8"/>
                <circle cx="30" cy="32" r="5" fill="rgba(196,151,47,0.85)"/>
                <circle cx="30" cy="32" r="9" fill="rgba(196,151,47,0.15)"/>
                <circle cx="30" cy="32" r="13" fill="rgba(196,151,47,0.07)"/>
                <path d="M21 26 L30 13 L39 26 Z" fill="rgba(232,228,217,0.18)" stroke="rgba(232,228,217,0.3)" stroke-width="0.8"/>
              </svg>
              <div class="lh-beam"></div>
            </div>
            <div class="lh-xp-wrap">
              <div class="lh-xp-bar"><div class="lh-xp-fill" id="lhXpFill" style="width:60%;"></div></div>
              <div class="lh-xp-label" id="lhXpLabel">60 / 100 xp to Level 5</div>
            </div>
            <div class="lh-reached" id="lhReached">Your light reached <strong>42 strangers</strong> across <strong>17 countries</strong></div>
            <div class="lh-status">brightness: active</div>
          </div>
          <div class="notif-block">
            <div class="notif-em">ðŸ”¦</div>
            <div class="notif-body"><strong>Someone is waiting for your light.</strong><br>You haven't visited in 3 days. Your lighthouse is beginning to fade.</div>
          </div>
          <div class="tab-bar">
            <div class="tab-item" onclick="show('home')"><span class="tab-icon-wrap"><span class="tab-icon">âš“</span></span>Letters</div>
            <div class="tab-item" onclick="show('map')"><span class="tab-icon-wrap"><span class="tab-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M3 12 Q7 8 12 12 Q17 16 21 12"/><path d="M12 3 Q8 7 12 12 Q16 17 12 21"/></svg></span></span>Map</div>
            <div class="tab-item" onclick="show('chat')"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ”¦</span></span>Chats</div>
            <div class="tab-item active"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ®</span></span>Profile</div>
          </div>
        </div>
      </div>

      <!-- MAP -->
      <div id="map" class="screen">
        <div class="map-screen">
          <div class="map-header">
            <div class="map-title">Map of Harbors</div>
            <div class="map-subtitle" id="mapLiveCount">â— 2,847 lights active</div>
          </div>
          <div class="map-canvas-wrap">
            <canvas id="worldMap" width="393" height="480"></canvas>
            <div class="map-legend">
              <div class="legend-item"><span class="legend-dot active"></span>Active lighthouse</div>
              <div class="legend-item"><span class="legend-dot storm"></span>Storm zone</div>
              <div class="legend-item"><span class="legend-dot drift"></span>Letter in transit</div>
            </div>
          </div>
          <div class="map-you-section">
            <div class="map-you-label">Your light</div>
            <div class="map-you-stat">reached <strong id="reachedCount">42</strong> strangers across <strong>17</strong> countries</div>
          </div>
          <div class="map-recent">
            <div class="map-recent-label">recently active near you</div>
            <div class="map-beacons" id="mapBeacons"></div>
          </div>
          <div class="tab-bar">
            <div class="tab-item" onclick="show('home')"><span class="tab-icon-wrap"><span class="tab-icon">âš“</span></span>Letters</div>
            <div class="tab-item active"><span class="tab-icon-wrap"><span class="tab-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M3 12 Q7 8 12 12 Q17 16 21 12"/><path d="M12 3 Q8 7 12 12 Q16 17 12 21"/></svg></span></span>Map</div>
            <div class="tab-item" onclick="show('chat')"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ”¦</span></span>Chats</div>
            <div class="tab-item" onclick="show('profile')"><span class="tab-icon-wrap"><span class="tab-icon">ðŸ®</span></span>Profile</div>
          </div>
        </div>
      </div>

      <!-- TRANSIT -->
      <div id="transit" class="screen">
        <div class="transit-screen">
          <div class="transit-ocean">
            <div class="transit-wave tw1"></div>
            <div class="transit-wave tw2"></div>
            <div class="transit-wave tw3"></div>
          </div>
          <div class="transit-bottle-wrap">
            <div class="transit-bottle">
              <svg width="52" height="122" viewBox="0 0 52 122" fill="none">
                <rect x="18" y="1" width="16" height="11" rx="4" fill="rgba(160,120,70,0.7)"/>
                <path d="M19 12 L17 27 L35 27 L33 12 Z" fill="rgba(180,220,240,0.18)" stroke="rgba(180,220,240,0.3)" stroke-width="0.7"/>
                <path d="M17 27 Q6 32 6 46 L6 82 Q6 102 26 102 Q46 102 46 82 L46 46 Q46 32 35 27 Z" fill="rgba(180,220,240,0.14)" stroke="rgba(180,220,240,0.28)" stroke-width="0.8"/>
                <path d="M7.5 50 Q7 58 7 68 L7 82 Q7 99 26 99 Q45 99 45 82 L45 68 Q45 58 44.5 50 Z" fill="rgba(15,52,96,0.55)"/>
                <rect x="16" y="40" width="20" height="13" rx="1.5" fill="rgba(245,240,232,0.55)" transform="rotate(-4 16 40)"/>
                <line x1="18" y1="44" x2="33" y2="44" stroke="rgba(26,26,46,0.2)" stroke-width="0.8"/>
                <line x1="18" y1="48" x2="32" y2="48" stroke="rgba(26,26,46,0.15)" stroke-width="0.8"/>
                <path d="M10 38 Q9 54 9 70" stroke="rgba(200,240,255,0.18)" stroke-width="1.5" fill="none" stroke-linecap="round"/>
              </svg>
            </div>
          </div>
          <div class="transit-content">
            <div class="transit-label">your letter is drifting</div>
            <div class="transit-title">somewhere out there</div>
            <div class="transit-timer-wrap">
              <div class="transit-timer-bar"><div class="transit-timer-fill" id="transitFill"></div></div>
              <div class="transit-eta" id="transitEta">arrives in approximately 4â€“8 hours</div>
            </div>
            <div class="transit-coord" id="transitCoord">last seen at 41Â°N 028Â°E</div>
          </div>
          <button class="transit-home-btn" onclick="show('home')">â† Back to harbour</button>
        </div>
      </div>

      <!-- MOMENTS -->
      <div id="moments" class="screen">
        <div class="moments-screen">
          <div class="write-header">
            <button class="back-btn" onclick="show('profile')">â†</button>
            <div class="write-title">Collected Lines</div>
          </div>
          <div class="moments-intro">Lines that stayed with you.</div>
          <div class="moments-list" id="momentsList"></div>
        </div>
      </div>

    </div><!-- end screens-container -->

    <!-- Canvas modal (inside phone) -->
    <div class="canvas-modal" id="canvasModal">
      <div class="canvas-box">
        <div class="canvas-title">Add a sketch to your letter</div>
        <canvas id="drawCanvas" width="280" height="180"></canvas>
        <div class="canvas-tools">
          <div class="cdot sel" style="background:#1a1a2e;" data-c="#1a1a2e" onclick="setCol(this)"></div>
          <div class="cdot" style="background:#5a3e2b;" data-c="#5a3e2b" onclick="setCol(this)"></div>
          <div class="cdot" style="background:#0f3460;" data-c="#0f3460" onclick="setCol(this)"></div>
          <div class="cdot" style="background:#c4972f;" data-c="#c4972f" onclick="setCol(this)"></div>
          <div class="cdot" style="background:#8b6b4a;" data-c="#8b6b4a" onclick="setCol(this)"></div>
          <button class="c-btn" onclick="clearCanvas()">Clear</button>
          <button class="c-btn done-btn" onclick="closeCanvas()">Done</button>
        </div>
      </div>
    </div>

    <!-- Send animation -->
    <div class="send-anim" id="sendAnim">
      <div class="sa-stars" id="saStars"></div>
      <div class="sa-ocean">
        <div class="sa-wave sa-w1"></div>
        <div class="sa-wave sa-w2"></div>
      </div>
      <div class="sa-bottle" id="saBottle">
        <svg width="36" height="86" viewBox="0 0 36 86" fill="none">
          <rect x="12" y="1" width="12" height="8" rx="3" fill="rgba(160,120,70,0.8)"/>
          <path d="M13 9 L11 20 L25 20 L23 9 Z" fill="rgba(180,220,240,0.2)" stroke="rgba(180,220,240,0.3)" stroke-width="0.5"/>
          <path d="M11 20 Q4 24 4 36 L4 62 Q4 76 18 76 Q32 76 32 62 L32 36 Q32 24 25 20 Z" fill="rgba(180,220,240,0.15)" stroke="rgba(180,220,240,0.3)" stroke-width="0.7"/>
          <path d="M5 42 Q5 48 5 58 L5 62 Q5 74 18 74 Q31 74 31 62 L31 58 Q31 48 31 42 Z" fill="rgba(15,52,96,0.6)"/>
          <rect x="11" y="33" width="14" height="9" rx="1" fill="rgba(245,240,232,0.55)" transform="rotate(-4 11 33)"/>
          <path d="M7 28 Q6 42 6 54" stroke="rgba(200,240,255,0.18)" stroke-width="1.2" fill="none" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="sa-content">
        <div class="sa-title" id="saTitle">Your letter is sealed.</div>
        <div class="sa-sub" id="saSub">Drifting towards open seaâ€¦</div>
        <div class="sa-tone-badge" id="saToneBadge"></div>
      </div>
    </div>

  </div><!-- end iphone-screen -->
</div><!-- end iphone-wrapper -->

<script>
  // Show screen
  let mapInited = false;
  function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    const map = ['splash','onboard','home','write','read','chat','profile','map','transit','moments'];
    document.querySelectorAll('.nav-pills button').forEach((b,i) => b.classList.toggle('active', map[i]===id));
    const el = document.getElementById(id);
    if(el) el.scrollTop = 0;
    if (id === 'map' && !mapInited) { mapInited = true; initWorldMap(); }
    if (id === 'profile') renderLightLevel();
    if (id === 'moments') renderMoments();
    if (id === 'transit') animateTransitCoords();
    if (id === 'chat') addReactionsToMessages();
  }

  // Generate stars
  const starsEl = document.getElementById('starsEl');
  for (let i = 0; i < 90; i++) {
    const s = document.createElement('div');
    s.className = 'splash-star';
    const sz = Math.random() * 1.8 + 0.4;
    const top = Math.random() * 62;
    s.style.cssText = `width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${top}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*5}s;--o:${0.15+Math.random()*0.6};`;
    starsEl.appendChild(s);
  }

  // Name selection
  function pickName(el) {
    document.querySelectorAll('.name-option').forEach(n => n.classList.remove('chosen'));
    el.classList.add('chosen');
  }

  // Char count
  function updateChar() {
    const t = document.getElementById('letterText');
    document.getElementById('charCount').textContent = t.value.length + ' characters';
  }

  // Send animation (V2 enhanced)
  function triggerSendAnim() {
    const txt = document.getElementById('letterText').value.trim();
    if (!txt) { document.getElementById('letterText').focus(); return; }
    const anim = document.getElementById('sendAnim');
    document.getElementById('saToneBadge').textContent = selectedTone;
    document.getElementById('saSub').textContent = selectedDest === 'shore'
      ? 'Drifting towards ' + (document.getElementById('regionSelect').value || 'a distant shore') + 'â€¦'
      : 'Drifting towards open seaâ€¦';
    const starsDiv = document.getElementById('saStars');
    starsDiv.innerHTML = '';
    for (let i = 0; i < 60; i++) {
      const s = document.createElement('div');
      const sz = Math.random() * 1.5 + 0.3;
      s.style.cssText = 'position:absolute;border-radius:50%;background:white;width:' + sz + 'px;height:' + sz + 'px;left:' + Math.random() * 100 + '%;top:' + Math.random() * 60 + '%;opacity:' + (0.1 + Math.random() * 0.5) + ';';
      starsDiv.appendChild(s);
    }
    anim.classList.add('show');
    if (typeof lightSystem !== 'undefined') lightSystem.addXP(30);
    setTimeout(() => {
      anim.classList.remove('show');
      document.getElementById('letterText').value = '';
      updateChar();
      show('transit');
    }, 3400);
  }

  // Canvas drawing
  let drawing = false, ctx, color = '#1a1a2e';
  function openCanvas() {
    document.getElementById('canvasModal').classList.add('open');
    const c = document.getElementById('drawCanvas');
    ctx = c.getContext('2d');
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = color;
    c.onmousedown = e => { drawing = true; ctx.beginPath(); ctx.moveTo(...pos(e,c)); };
    c.onmousemove = e => { if(!drawing) return; ctx.strokeStyle = color; ctx.lineTo(...pos(e,c)); ctx.stroke(); };
    c.onmouseup = c.onmouseleave = () => drawing = false;
    c.ontouchstart = e => { e.preventDefault(); drawing = true; ctx.beginPath(); ctx.moveTo(...posT(e,c)); };
    c.ontouchmove = e => { e.preventDefault(); if(!drawing) return; ctx.strokeStyle = color; ctx.lineTo(...posT(e,c)); ctx.stroke(); };
    c.ontouchend = () => drawing = false;
  }
  function pos(e,c) { const r=c.getBoundingClientRect(); return [e.clientX-r.left, e.clientY-r.top]; }
  function posT(e,c) { const r=c.getBoundingClientRect(); return [e.touches[0].clientX-r.left, e.touches[0].clientY-r.top]; }
  function setCol(el) { document.querySelectorAll('.cdot').forEach(d=>d.classList.remove('sel')); el.classList.add('sel'); color=el.dataset.c; }
  function clearCanvas() { if(ctx) { ctx.clearRect(0,0,280,180); } }
  function closeCanvas() { document.getElementById('canvasModal').classList.remove('open'); }

  // Chat send
  let msgCount = 4;
  function sendChatMsg() {
    const input = document.getElementById('chatInput');
    const txt = input.value.trim();
    if (!txt) return;
    const msgs = document.getElementById('chatMsgs');
    const now = new Date();
    const t = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
    const div = document.createElement('div');
    div.className = 'msg me';
    div.innerHTML = '<div class="msg-bubble">' + txt + '</div><div class="msg-time">' + t + '</div>';
    msgs.appendChild(div);
    input.value = '';
    input.style.height = 'auto';
    msgs.scrollTop = msgs.scrollHeight;
    msgCount++;
    if (msgCount % 3 === 0) addDepthHint();
    if (typeof lightSystem !== 'undefined') lightSystem.addXP(20);
    addReactionsToMessages();
    setTimeout(showTyping, 1500);
  }
  function showTyping() {
    const el = document.getElementById('typingIndicator');
    if (!el) return;
    el.style.display = 'block';
    const msgs = document.getElementById('chatMsgs');
    if (msgs) msgs.scrollTop = msgs.scrollHeight;
    setTimeout(function() { el.style.display = 'none'; }, 2500);
  }
  function handleChatKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChatMsg(); }
  }

  // Auto resize chat input
  document.getElementById('chatInput').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 90) + 'px';
  });

  // V2 â€” Data & Map
  let selectedTone = 'melancholy';
  let selectedDest = 'sea';
  function selectTone(el) {
    document.querySelectorAll('.tone-pill').forEach(p => p.classList.remove('active'));
    el.classList.add('active');
    selectedTone = el.dataset.tone;
  }
  function selectDest(el) {
    document.querySelectorAll('.dest-opt').forEach(d => d.classList.remove('active'));
    el.classList.add('active');
    selectedDest = el.dataset.dest;
    document.getElementById('regionPicker').style.display = selectedDest === 'shore' ? 'block' : 'none';
  }

  const lightSystem = {
    level: 4, streak: 3, reached: 42, xp: 340, xpToNext: 100,
    addXP: function(pts) {
      this.xp += pts;
      this.xpToNext -= pts;
      if (this.xpToNext <= 0) {
        this.level = Math.min(this.level + 1, 10);
        this.xpToNext = this.level * 80;
      }
      renderLightLevel();
    }
  };

  function renderLightLevel() {
    const ls = lightSystem;
    const pct = Math.max(0, Math.min(100, ((ls.level * 80 - ls.xpToNext) / (ls.level * 80)) * 100));
    const fill = document.getElementById('lhXpFill');
    const label = document.getElementById('lhXpLabel');
    const badge = document.getElementById('lhLevelBadge');
    const streak = document.getElementById('lhStreak');
    const reached = document.getElementById('lhReached');
    const momentsCount = document.getElementById('momentsCount');
    if (fill) fill.style.width = pct + '%';
    if (label) label.textContent = (ls.level * 80 - ls.xpToNext) + ' / ' + (ls.level * 80) + ' xp to Level ' + (ls.level + 1);
    if (badge) badge.textContent = 'Level ' + ls.level;
    if (streak) streak.textContent = 'ðŸ”¥ ' + ls.streak + ' day streak';
    if (reached) reached.innerHTML = 'Your light reached <strong>' + ls.reached + ' strangers</strong> across <strong>17 countries</strong>';
    if (momentsCount && typeof savedMoments !== 'undefined') momentsCount.textContent = savedMoments.length + ' saved';
  }

  let savedMoments = [
    { text: 'Rivers breathe too. In their own way.', from: 'Northern Flame', date: 'Feb 28' },
    { text: 'Some things need time to travel.', from: 'Silver Harbour', date: 'Feb 22' },
    { text: 'Autumn feels particularly long this year.', from: 'Lunar Tide', date: 'Feb 14' },
  ];
  function saveMoment() {
    const btn = document.getElementById('saveLineBtn');
    const text = 'Do you ever just listen to something, with no particular reason?';
    savedMoments.unshift({ text: text, from: 'Northern Flame', date: 'Today' });
    btn.classList.add('saved');
    btn.innerHTML = 'âœ¦ Saved to Moments';
    setTimeout(function() {
      btn.classList.remove('saved');
      btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"><polygon points="7,1 8.8,5.2 13.5,5.5 10,8.5 11.1,13.2 7,10.5 2.9,13.2 4,8.5 0.5,5.5 5.2,5.2"/></svg> Save a line';
    }, 2500);
    renderMoments();
  }
  function renderMoments() {
    const list = document.getElementById('momentsList');
    if (!list) return;
    list.innerHTML = savedMoments.map(function(m) {
      return '<div class="moment-card"><div class="moment-text">' + m.text + '</div><div class="moment-meta"><div class="moment-from">â€” ' + m.from + '</div><div class="moment-date">' + m.date + '</div></div></div>';
    }).join('');
  }

  function initWorldMap() {
    const canvas = document.getElementById('worldMap');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0, '#030810');
    bg.addColorStop(1, '#060e1a');
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, W, H);
    ctx.fillStyle = 'rgba(15,30,55,0.85)';
    ctx.strokeStyle = 'rgba(30,55,90,0.6)';
    ctx.lineWidth = 0.8;
    const continents = [
      [[55,40],[130,35],[145,55],[150,100],[130,140],[100,160],[70,155],[45,130],[30,95],[40,65]],
      [[95,170],[120,160],[135,200],[130,250],[115,290],[90,295],[75,270],[70,225],[80,185]],
      [[185,30],[220,25],[235,45],[225,70],[205,75],[185,65],[175,45]],
      [[185,80],[220,75],[240,110],[245,180],[230,240],[210,255],[190,245],[175,200],[170,140],[178,95]],
      [[225,25],[310,20],[345,35],[360,75],[350,110],[320,125],[290,130],[260,115],[240,90],[230,60]],
      [[305,200],[345,195],[360,220],[355,245],[330,255],[305,245],[295,225]],
      [[115,15],[145,12],[155,30],[140,45],[115,42],[105,28]],
    ];
    continents.forEach(function(pts) {
      ctx.beginPath();
      ctx.moveTo(pts[0][0], pts[0][1]);
      pts.slice(1).forEach(function(p) { ctx.lineTo(p[0], p[1]); });
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    });
    ctx.strokeStyle = 'rgba(30,60,100,0.2)';
    ctx.lineWidth = 0.5;
    for (let x = 0; x < W; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += 35) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }
    const lighthouses = [
      {x:198,y:55,intensity:0.9,size:3},{x:210,y:48,intensity:0.7,size:2},{x:160,y:45,intensity:1,size:3.5,isYou:true},
      {x:320,y:65,intensity:0.8,size:2.5},{x:290,y:85,intensity:0.6,size:2},{x:340,y:210,intensity:0.7,size:2},{x:110,y:90,intensity:0.9,size:3},
      {x:85,y:65,intensity:0.5,size:1.8},{x:240,y:150,intensity:0.8,size:2.5},{x:270,y:45,intensity:0.6,size:2},{x:125,y:105,intensity:0.7,size:2.2},
      {x:185,y:200,intensity:0.5,size:1.8},{x:230,y:100,intensity:0.9,size:2.8},{x:310,y:100,intensity:0.6,size:2},{x:195,y:140,intensity:0.7,size:2},
      {x:260,y:210,intensity:0.5,size:1.5},{x:350,y:80,intensity:0.8,size:2.5},
    ];
    const storms = [{x:200,y:50,r:22},{x:108,y:92,r:18},{x:295,y:70,r:15}];
    storms.forEach(function(s) {
      const gradient = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r);
      gradient.addColorStop(0, 'rgba(80,120,255,0.18)');
      gradient.addColorStop(1, 'transparent');
      ctx.fillStyle = gradient;
      ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2); ctx.fill();
    });
    lighthouses.forEach(function(lh) {
      const color = lh.isYou ? '#c4972f' : 'rgba(196,151,47,' + lh.intensity + ')';
      const glow = ctx.createRadialGradient(lh.x, lh.y, 0, lh.x, lh.y, lh.size * 4);
      glow.addColorStop(0, lh.isYou ? 'rgba(196,151,47,0.5)' : 'rgba(196,151,47,' + (lh.intensity * 0.3) + ')');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.beginPath(); ctx.arc(lh.x, lh.y, lh.size * 4, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = color;
      ctx.beginPath(); ctx.arc(lh.x, lh.y, lh.size, 0, Math.PI * 2); ctx.fill();
      if (lh.isYou) {
        ctx.strokeStyle = 'rgba(196,151,47,0.5)';
        ctx.lineWidth = 1;
        ctx.beginPath(); ctx.arc(lh.x, lh.y, lh.size + 4, 0, Math.PI * 2); ctx.stroke();
      }
    });
    const routes = [{from:[160,45],to:[198,55]},{from:[110,90],to:[240,150]},{from:[320,65],to:[160,45]},{from:[85,65],to:[185,200]}];
    routes.forEach(function(r) {
      ctx.strokeStyle = 'rgba(232,228,217,0.12)';
      ctx.lineWidth = 0.8;
      ctx.setLineDash([3, 5]);
      ctx.beginPath();
      const mx = (r.from[0] + r.to[0]) / 2 + (Math.random() - 0.5) * 30;
      const my = (r.from[1] + r.to[1]) / 2 + (Math.random() - 0.5) * 20;
      ctx.moveTo(r.from[0], r.from[1]);
      ctx.quadraticCurveTo(mx, my, r.to[0], r.to[1]);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.fillStyle = 'rgba(232,228,217,0.5)';
      ctx.beginPath(); ctx.arc(mx, my, 1.5, 0, Math.PI * 2); ctx.fill();
    });
    let frame = 0;
    function animateMap() {
      if (!document.getElementById('map').classList.contains('active')) return;
      frame++;
      lighthouses.forEach(function(lh) {
        const pulse = Math.sin(frame * 0.04 + lh.x) * 0.3 + 0.7;
        const glow = ctx.createRadialGradient(lh.x, lh.y, 0, lh.x, lh.y, lh.size * 5);
        glow.addColorStop(0, 'rgba(196,151,47,' + (lh.intensity * pulse * 0.5) + ')');
        glow.addColorStop(1, 'transparent');
        ctx.fillStyle = glow;
        ctx.beginPath(); ctx.arc(lh.x, lh.y, lh.size * 5, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = 'rgba(196,151,47,' + (lh.intensity * (0.7 + pulse * 0.3)) + ')';
        ctx.beginPath(); ctx.arc(lh.x, lh.y, lh.size, 0, Math.PI * 2); ctx.fill();
      });
      requestAnimationFrame(animateMap);
    }
    animateMap();
    const beaconData = [
      {name: 'Northern Flame', loc: 'Milan, Italy', dist: 'writing now', color: 'rgba(196,151,47,0.9)'},
      {name: 'Lunar Tide', loc: 'ReykjavÃ­k, Iceland', dist: '2h ago', color: 'rgba(196,151,47,0.6)'},
      {name: 'Hollow Crest', loc: 'Kyoto, Japan', dist: 'yesterday', color: 'rgba(196,151,47,0.35)'},
    ];
    const container = document.getElementById('mapBeacons');
    if (container) {
      container.innerHTML = beaconData.map(function(b) {
        return '<div class="beacon-row"><div class="beacon-dot-live" style="background:' + b.color + ';box-shadow:0 0 6px ' + b.color + '"></div><div class="beacon-name">' + b.name + '</div><div class="beacon-loc">' + b.loc + '</div><div class="beacon-dist">' + b.dist + '</div></div>';
      }).join('');
    }
    let count = 2847;
    setInterval(function() {
      count += Math.floor(Math.random() * 3) - 1;
      const el = document.getElementById('mapLiveCount');
      if (el) el.textContent = 'â— ' + count.toLocaleString() + ' lights active';
    }, 4000);
  }

  function addReactionsToMessages() {
    document.querySelectorAll('.msg-bubble').forEach(function(bubble) {
      if (bubble.querySelector('.react-btn')) return;
      const btn = document.createElement('button');
      btn.className = 'react-btn';
      btn.innerHTML = 'âœ¦';
      btn.title = 'This stayed with me';
      btn.onclick = function(e) {
        e.stopPropagation();
        if (this.classList.contains('reacted')) return;
        this.classList.add('reacted');
        this.textContent = 'âœ¦';
        const float = document.createElement('span');
        float.className = 'react-float';
        float.textContent = 'âœ¦';
        this.parentElement.appendChild(float);
        setTimeout(function() { float.remove(); }, 1000);
      };
      bubble.appendChild(btn);
    });
  }

  function sendWave() {
    const msgs = document.getElementById('chatMsgs');
    const now = new Date();
    const t = now.getHours() + ':' + String(now.getMinutes()).padStart(2, '0');
    const div = document.createElement('div');
    div.className = 'msg me';
    div.innerHTML = '<div class="msg-bubble wave-msg">ã€° a wave from across the water</div><div class="msg-time">' + t + '</div>';
    msgs.appendChild(div);
    msgs.scrollTop = msgs.scrollHeight;
    if (typeof lightSystem !== 'undefined') lightSystem.addXP(5);
    addReactionsToMessages();
  }

  function addDepthHint() {
    const msgs = document.getElementById('chatMsgs');
    if (!msgs) return;
    const hints = ['You both tend to write at night.', 'You share a certain quietness.', 'This is your 3rd exchange.', 'You both chose words carefully today.', 'Something unspoken moves between these lines.'];
    const div = document.createElement('div');
    div.className = 'depth-hint';
    div.textContent = hints[Math.floor(Math.random() * hints.length)];
    msgs.appendChild(div);
    msgs.scrollTop = msgs.scrollHeight;
  }

  function animateTransitCoords() {
    const el = document.getElementById('transitCoord');
    if (!el) return;
    setInterval(function() {
      if (!document.getElementById('transit') || !document.getElementById('transit').classList.contains('active')) return;
      const lat = (35 + Math.random() * 20).toFixed(0);
      const lon = (10 + Math.random() * 40).toFixed(0);
      const ns = Math.random() > 0.3 ? 'N' : 'S';
      const ew = Math.random() > 0.4 ? 'E' : 'W';
      el.textContent = 'last seen at ' + lat + 'Â°' + ns + ' 0' + lon + 'Â°' + ew;
    }, 4500);
  }
</script>
</body>
</html>
